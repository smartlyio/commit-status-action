name: 'Create pending github commit statuses'
description: Create a github commit status context in the pending state

inputs:
  github-token:
    description: "Github authentication token"
    required: true
  context:
    description: "Github status context"
    default: continuous-integration/github-actions/status
  target-url:
    description: "URL to include in the status"
    default: "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
  sha:
    description: "Commit sha to attach the status to if it's different from the workflow run commit"
    required: false
    default: ""

outputs:
  commit_status_sha:
    description: "The commit sha that the status is attached to"
    value: ${{ steps.commit_status_sha.outputs.sha }}

runs:
  using: "composite"
  steps:
    - name: Determine commit to put the build status on
      id: commit_status_sha
      shell: bash
      env:
        COMMIT_STATUS_SHA: ${{ inputs.sha }}
        PULL_REQUEST_SHA: ${{ github.event.pull_request.head.sha }}
        GITHUB_SHA: ${{ github.sha }}
      run: |
        "${GITHUB_ACTION_PATH}/get-commit-sha.bash"
    - name: Create commit status
      shell: bash
      env:
        GITHUB_TOKEN: ${{ inputs.github-token }}
        TARGET_URL: ${{ inputs.target-url }}
        COMMIT_STATUS_SHA: ${{ steps.commit_status_sha.outputs.sha }}
        DESCRIPTION: "Build status is pending"
        CONTEXT: ${{ inputs.context }}
      run: |
        "${GITHUB_ACTION_PATH}/create-commit-status.bash"
